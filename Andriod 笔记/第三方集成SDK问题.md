##Andorid中遇到的第三方SDK问题综合

###1、短信验证遇到的问题 -- MobSMSSDK
* 有时会Toast提示：应用无权限读取通讯录，本来就不想读取通讯录，也不想要Toast提示
* 解决办法：SMSSDK初始化的时候，最后一个参数设置为false
* SMSSDK.initSDK(this, "1c737dd104", "b40e603318691ef1c6",false);

###2、极光推送遇到的问题
* 应用程序无法收到推送信息
* 可能的原因：极光推送的后台服务被杀死后不能自动重启
	* android原生系统，没有 root，用 home 键上滑杀进程等其他系统自带的停止方式，都可以自启动，一般10s内恢复。但如果是强行停止就只能用户自己手动开启应用
	* 如果是miui等第三方应用，杀了进程默认无法自启动
	* 如果是root过的原生系统，杀了进程也是没有办法自启动的，这个时候推送是收不到的

###3、支付宝
* 从2017年1月份开始，支付宝SDK全面升级，应用需要重新签约
* 集成支付宝的步骤
	* 完成签约
	* 项目中添加alipaySDK的jar包
	* 项目中创建一个支付的activity
	* 权限声明
	* 添加混淆规则
	* 拼接订单信息，并通过POST请求发送到自己公司的服务器，服务器会给用户返回一个加密后的支付串码
	* 客户端使用拿到的加密串码，调用支付宝服务器提供的接口
	* 运用Handler消息机制异步处理支付结果
* 源码解析

		1、通过设置getOrderInfo()获得订单信息
		 String orderInfo = getOrderInfo("测试的商品", "该测试商品的详细描述", "0.01");
		2、对订单进行签名
		 String sign = sign(orderInfo);
		 try {  
		3、仅需对sign进行URL编码
        	sign = URLEncoder.encode(sign, "UTF-8");  
    	 } catch (UnsupportedEncodingException e) {  
       		e.printStackTrace();  
  		 }  
		4、将订单信息改成完全符合支付宝参数规范的订单信息
		 final String payInfo = orderInfo + "&sign=\"" + sign + "\"&"  
          + getSignType();

* 注意事项：
	* 支付串码的加密过程放在服务端来做，服务端给客户端开一个接口，用于加密支付串码。

###4、微信支付
* 通过向微信服务器发起请求，获取令牌access_token,拿到access_token才有调用各种特殊接口的权限	
* 获取access_token后，再次向微信服务器发送请求，获取一个预支付的id
* 这两步出于安全，放在服务端实现
* 客户端调用微信支付
	* 封装微信支付对象
	* 支付方法
* 处理支付结果，重写回调方法，参数errCode的值为0表示成功，值为-1表示错误，-2表示用户取消		

###5、百度地图、高德地图
* 调用SDKInitializer.initialize(this)运行异常，程序闪退
	*　权限问题造成的

* 百度地图应用中只显示网格，不显示地图图层
	* key认证错误造成的

*　高德地图不显示
	* 地图控件MapView的包名要正确，使用了文档上控件名，看了Demo发现包名不一致，文档没有更新

###6、第三方登陆 -- mob
* 第三方登陆分“要数据不要功能”（有注册和登陆功能）
	* 步骤：1、用户触发第三方登录事件
	* showUser(null)请求授权用户的资料（这个功能可能涉及授权操作）
	* 如果onComplete()方法被回调，将其参数Hashmap代入你应用的Login流程
	* 否则提示错误，调用removeAccount(true)，删除可能的授权缓存数据
	* Login时客户端发送用户资料中的用户ID给服务端
	* 服务端判定用户是已注册用户，则引导用户进入系统，否则返回特定错误码
	* 客户端收到“未注册用户”错误码以后，代入用户资料到你应用的Register流程
	* Register时在用户资料中挑选你应用的注册所需字段，并提交服务端注册
	* 服务端完成用户注册，成功则反馈客户端引导用户进入系统
	* 否则提示错误，调用removeAccount(true)方法，删除可能的授权缓存数据

* “要功能不要数据”（没有注册和登陆功能，也不打算维护这个功能）
	* 步骤：1、用户触发第三方登录事件
	* 2、调用platform.getDb().getUserId()请求用户在此平台上的ID
	* 3、如果用户ID存在，则认为用户是合法用户，运行进入系统，否则调用authorize()
	* 4、authorize()方法将引导用户在授权页面输入账号密码，然后目标平台将验证此用户
	* 5、如果onComplete()方法将被回调，表示授权成功，引导用户进入系统
	* 否则提示错误，调用removeAccount(true)方法，删除可能的授权缓存数据

* 微博，授权后提示，你所访问的站点在微博认证失败，错误号：21322
* 解决办法：
	* 先确认微博那边的回调地址是不是对的
	* 再看看是不是把第三方信息跟友盟的后台绑定（设置对应的appkey 和 appsecret）
	* 微博那边设置安全域名；
	* 最后等待审核通过，基本上就没问题了

###7、第三方分享 -- mob
* 微信分享，分为绕过审核和不绕过审核（sharesdk.xml文件中的微信配置代码属性-BypassApproval），绕过审核分享给好友的时候，只能分享图片文件，分享到朋友圈也只是文字图片；不绕过审核，就是正常的分享网页链接的方式
	* 测试打包成apk安装到手机进行测试	
	* 打包的keystore跟微信开放平台上的签名一致，即与MD5码一致
	* 分享参数没有错误
	* 申请的应用在微信上审核通过
	* 包名要和开放平台上一致